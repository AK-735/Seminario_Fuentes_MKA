---
title: "Registros de VIH correlacionado con diversos factores"
author: "Amina Khantimirova, Wiam Messari y Emma Arrieta"
date: "`r Sys.Date()`"
output: 
  html_document:
    toc: true
    toc_float: true
    toc_depth: 3
    theme: flatly     
    highlight: tango  
    df_print: paged 
---

<style>
body {
  text-align: justify;
  font-family: "Poppins", "Segoe UI", sans-serif;
  background-color: #fff0f5;
  color: #333;
}
</style>

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```
[Enlace al repositorio de GitHub] (https://github.com/AK-735/Seminario_Fuentes_MKA)

## **Introducción**

El **VIH** significa virus de inmunodeficiencia humana. Daña su sistema inmunitario al destruir un tipo de glóbulo blanco que ayuda a su cuerpo a combatir las infecciones. Esto lo pone en riesgo de tener otras infecciones y enfermedades.

Esta enfermedad afecta a un gran porcentaje de la población española, resultando en un foco de malestar. En este seminario estudiaremos aquellos indicativos que potencian la expresión de dicha enfermedad. 

Nuestro primer foco de interés es estudiar la correlación entre la orientación sexual y el VIH, pero también incluiremos otros factores de riesgo que podrían desencadenar el virus.


## **Objetivo general**

Conocer mediante el estudio de tablas la correlación que puede llegar a existir entre entre la orientación sexual de un individuo y su predisposición a contraer la enfermedad del VIH.


## **Objetivos específicos**

1. ¿Cuál es la comunidad autónoma con más casos de VIH en 2023 por conducta homosexual? ¿Y heterosexual?
2. ¿Cuál es el motivo más común por el que se produce la enfermedad en dicha comunidad autónoma?
3. ¿Qué porcentaje de hombres tiene la enfermedad con menos de 40 años en la provincia de Burgos?
4. ¿Cuál es la evolución del impacto de la enfermedad en la población desde 2013 a 2023?
5. ¿Hay más casos de VIH cuanto mayor es la población?

## **Metodología**

Para realizar nuestro estudio, importamos las tablas que tenemos guardadas en la carpeta DATA de nuestro repositorio.

```{r , eval = TRUE,message=FALSE, warning=FALSE}
# Datos importacion

#install.packages("readODS")
library(tidyverse)
library(rjson)
library(DT)
library(readODS) #hay que descargarse el paquete readODS

```
### **Importación datos en CSV:**

```{r , eval = TRUE,message=FALSE, warning = FALSE}

tabla_csv_orientacion <- read_csv("Input/DATA/VIH_orientaciónSexual.csv") 

#head(tabla_csv_orientacion)
names(tabla_csv_orientacion)

```
### **Importación datos en ods:**
```{r, eval = TRUE,message=FALSE, warning = FALSE}
Modotransmisioncompleto <- read_ods("Input/DATA/Modotranscompleto.ods")
ModotransmisionVIH <- read_ods("Input/DATA/modotransmisionVIH.ods")
motivosVIH <- read_ods("Input/DATA/motivosVIH.ods")
yearSexoVIH <- read_ods("Input/DATA/yearSexoVIH.ods")

```

### **Importación datos JSON:**

```{r , eval = TRUE,message=FALSE, warning=FALSE}
#file_path <- file.choose()

# Leer JSON de manera segura
REG_Vih <- fromJSON(file = "Input/DATA/registro-nuevas-infecciones-por-vih.json")

# Extraer la lista 'fields' de cada registro
REG_Vih_df <- map_dfr(REG_Vih, ~ .x$fields)

# Mostrar primeras filas en tabla interactiva
#str(REG_Vih_df)   
names(REG_Vih_df)

```
#``` {r , eval = TRUE,message=FALSE, warning=FALSE}
#REG_Vih_df %>% count(sexo)
#REG_Vih_df %>% count(conducta_sexual)

#ggplot(REG_Vih_df, aes(x = edad, fill = sexo)) +geom_histogram(binwidth = 5, position = "dodge")
#```
#```{r , eval = TRUE,message=FALSE, warning=FALSE}
#tabla_unida <- left_join(REG_Vih_df, tabla_csv_orientacion, by = c("edad" = "Edad", "sexo" = "Sexo"))
#glimpse(tabla_unida)
#datatable(tabla_unida, options = list(pageLength = 10, scrollX = TRUE))
#```

Ahora hacemos un left join, con el objetivo de analizar los datos de las tablas "registro-nuevas-infecciones-por-vih.json" y "VIH_orientaciónSexual.csv".

```{r , eval = TRUE,message=FALSE, warning=FALSE}
tabla_unida <- left_join(REG_Vih_df, tabla_csv_orientacion, by = c("edad" = "Edad", "sexo" = "Sexo"))
glimpse(tabla_unida)
datatable(tabla_unida, options = list(pageLength = 10, scrollX = TRUE))
```

### **Comparación casos VIH/conducta**

Esta tabla reúne aquellos casos de VIH provocados por conductas sexuales. El foco principal son los hombres, por lo que aquí son nuestro sujeto de estudio.

```{r, eval = TRUE,message=FALSE, warning=FALSE}

prevalencia_por_conducta <- tabla_csv_orientacion %>%
  filter(`Hábito sexual` %in% c("HSH", "Heterosexual")) %>%
  group_by(`Hábito sexual`) %>%
  summarise(
    Casos = n(),
    VIH_Positivo = sum(VIH == "SÍ"), 
  ) %>%
  mutate(
    `Tasa de Prevalencia (%)` = round((VIH_Positivo / Casos) * 100, 2)
  )

datatable(prevalencia_por_conducta, 
          caption = "Tasa de Prevalencia de VIH por Hábito Sexual")

print(prevalencia_por_conducta)
```

#``` {r , eval = TRUE,message=FALSE, warning=FALSE}
#ggplot(data = prevalencia_por_conducta, aes(x = `Hábito sexual`, y =`Tasa de Prevalencia(%)`))+geom_bar(aes(fill =# clarity), colour = "black")
#```







```{r , eval = TRUE, message=FALSE, warning=FALSE}

ggplot(data = prevalencia_por_conducta, 
       aes(x = `Hábito sexual`, 
           y = `Tasa de Prevalencia (%)`,
           fill = `Hábito sexual`)) +
  
  geom_col(colour = "black", width = 0.6) +
  
  geom_text(aes(label = paste0(`Tasa de Prevalencia (%)`, "%")), 
            vjust = -0.6, size = 4) +
  
  labs(
    title = "Gráfico de barras de la prevalencia de VIH",
    x = "Hábito Sexual",
    y = "Tasa de Prevalencia (%)",
    subtitle = "Tasa de Prevalencia de VIH por Hábito Sexual"
  ) 
```



Aquí tenemos una comparación de aquellos que mantienen relaciones sexuales siempre con preservativo y los que no. Aquellos que mantienen relaciones homosexuales no suelen usar preservativos con la misma frecuencia que aquellos hombres que mantienen relaciones heterosexuales.
Esto puede ser debido a que no existe riesgo de embarazo. Por ello, es muy importante enfatizar en la población española sobre la importancia de preservativo, más allá del deseo de no concebir:

```{r, eval = TRUE,message=FALSE, warning=FALSE}

uso_preservativo <- tabla_csv_orientacion %>%
  filter(`Hábito sexual` %in% c("HSH", "Heterosexual")) %>%
  group_by(`Hábito sexual`) %>%
  count(`preservativo siempre`, name = "Frecuencia") %>%

  group_by(`Hábito sexual`) %>%
  mutate(
    Total_Grupo = sum(Frecuencia),
    `Porcentaje (%)` = round((Frecuencia / Total_Grupo) * 100, 2)
  ) %>%
  ungroup()

uso_siempre <- uso_preservativo %>% filter(`preservativo siempre` == "SÍ")

datatable(uso_siempre, 
          caption = "Porcentaje de Uso de Preservativo 'Siempre'")
```


```{r, eval = TRUE,message=FALSE, warning=FALSE}
ggplot(data = uso_preservativo, aes(x=`Hábito sexual`, y = `Porcentaje (%)`, color = `preservativo siempre`)) +
  geom_point(size = 8, shape = 18) + 
  geom_line(aes(group = `preservativo siempre`), size = 0.5, linetype = "dashed") + 
  geom_text(aes(label = paste0(`Porcentaje (%)`, "%")), 
            color = "black", 
            size = 3.5, 
            vjust = -1.5,
            hjust = 0.25) +
  labs(
    title = "Comparación del Uso 'Siempre' de Preservativo",
    subtitle = "Porcentaje de hombres que usan preservativo en cada hábito sexual",
    x = "Hábito Sexual",
    y = "Porcentaje de Uso (%)",
    color = "¿Preservativo siempre?"
    
  )+
  scale_y_continuous(labels = scales::percent_format(scale = 1), limits = c(0, 100)) +
  theme_minimal(base_size = 14)


```


Aquí empleamos una tabla anterior para estudiar si el número de parejas afecta en el desarrollo del VIH. Cabe destacar que aquí se han incluido tanto como hombre como podemos presenciar en la tabla para enfatizar la correlación que existe entre ser hombre y padecer esta enfermedad:

```{r, eval = TRUE,message=FALSE, warning=FALSE}

tabla_unida$edad <- as.numeric(tabla_unida$edad) 

riesgo_sifilis <- tabla_unida %>%

  filter(d_grupo_riesgo %in% c("Varones homosexuales / bisexuales", "Relaciones Heterosexuales")) %>%

  group_by(d_grupo_riesgo, `Estado sífilis`) %>% 

  summarise(
    Casos = n(),
    `Edad Promedio` = round(mean(edad, na.rm = TRUE), 2),
  ) %>%
  
  arrange(desc(Casos)) 

datatable(riesgo_sifilis, 
          caption = "Distribución por Edad, Riesgo y Sífilis")

promedio_parejas_clinico <- tabla_unida %>%

  mutate(`Parejas ultimo año` = as.numeric(`Parejas ultimo año`)) %>%
  group_by(sexo, estado_clinico) %>%

  summarise(
    `Promedio de Parejas` = round(mean(`Parejas ultimo año`, na.rm = TRUE), 2),
    `Total de Casos` = n(),
  ) %>%

  filter(estado_clinico %in% c("Asintom", "SIDA")) %>%
  arrange(sexo, desc(`Total de Casos`))
datatable(promedio_parejas_clinico, 
          caption = "Relación entre Parejas y Estado Clínico por Sexo")



tabla_unida
```
```{r, eval = TRUE,message=FALSE, warning=FALSE}
data_dispersion <- tabla_unida %>%
  filter(estado_clinico %in% c("Asintom", "SIDA")) %>%
  mutate(edad = as.numeric(edad),
         `Parejas ultimo año` = as.numeric(`Parejas ultimo año`)) %>%
  drop_na(edad, `Parejas ultimo año`, estado_clinico) 


# Generamos el gráfico de dispersión con línea de regresión (geom_smooth)
ggplot(data = data_dispersion, 
       aes(x = edad, 
           y = `Parejas ultimo año`, 
           color = estado_clinico)) +
  
  geom_point(alpha = 0.6, size = 2) +
  
  # 2. Capa de Regresión (geom_smooth)
  # method = "lm" traza una línea de regresión lineal (modelo lineal)
  # El color de la línea se mapea automáticamente a 'estado_clinico'
  geom_smooth(method = "lm", 
              se = TRUE,
              size = 1.2) + 
  
  labs(
    title = "Relación entre Edad y Número de Parejas por Estado Clínico del VIH",
    subtitle = "Análisis de regresión lineal con intervalo de confianza",
    x = "Edad del Individuo (años)",
    y = "Número de Parejas en el Último Año",
    color = "Estado Clínico"
  ) +
  
  scale_color_manual(values = c("Asintom" = "blue", "SIDA" = "red")) +
  theme_minimal(base_size = 14) +
  theme(legend.position = "bottom")


```

```{r, eval = TRUE,message=FALSE, warning=FALSE}



ggplot(data = riesgo_sifilis, aes(x = `Casos`, y = `Estado sífilis` , color = `Estado sífilis` ))+
  geom_point(size = 2)+
  labs(
    title = "Número de casos por estado de sifilis",
    y = "Estado de Sífilis",
    x = "Numero de casos"
  )+
  theme_classic()

```

```{r, eval = TRUE,message=FALSE, warning=FALSE}
ggplot(data = tabla_unida, aes(x= `edad`, y = `d_grupo_riesgo`, coulor = `d_grupo_riesgo`))+
  geom_boxplot(size = 1.5)+
  labs(
    title = "Distribucion de la edad por grupo de riesgo",
    x = "Edad",
    y = "Grupo de Riesgo",
  )+
  theme_classic()


```
```{r, eval = TRUE,message=FALSE, warning=FALSE}
causa_VIH <- 
  motivosVIH %>%
  filter(`Edad` %in% c( "Menos de 40 años", "40 y más años", na.rm = FALSE),
        `Motivo` %in% c("Fallo del método anticonceptivo utilizado", "Por no utilizar métodos anticonceptivos", "Mi pareja quería", "Otros", "Total")) %>%
  group_by(`Edad`, `Motivo`) %>%
  summarise(contar = n()) %>%
  mutate(
    porcentaje = (contar / sum(contar))*100
  ) %>%
  ungroup %>%
    arrange(`Edad`, desc(contar))

datatable(causa_VIH, 
          caption = "Tasa de Prevalencia de VIH por Hábito Sexual")

print(causa_VIH)

```

```{r , eval = TRUE,message=FALSE, warning=FALSE}
tabla_completa <- full_join(REG_Vih_df, tabla_csv_orientacion, by = c("edad" = "Edad", "sexo" = "Sexo"))

incidencia <- tabla_completa %>%
  filter(conducta_sexual %in% c("Homosex", "Hetersex", "Desconocido")) %>%
  group_by(conducta_sexual) %>%
  summarise(
    Casos = n())

datatable(incidencia, 
          caption = "Número de casos por conducta sexual")

print(incidencia)
```

## **Resultados**
Claramente, podemos observar en la primera tabla que los hombres homosexuales tienen más predisposición a contraer la enfermedad, que los hombres heterosexuales.

Además, la cuarta tabla muestra que hay más hombres homosexuales que sufren la enfermedad de los que, aunque la muestren, son asintomáticos.

## **Conclusiones generales**
En conclusión, hay mayor número de hombres homosexuales, en comparación con los heterosexuales, que presentan la enfermedad.

## **Referencias**
- Sec. (n.d.). Encuesta de Anticoncepción en España 2024. Sociedad Española De Contracepción. Retrieved October 15, 2025, from https://sec.es/encuesta-de-anticoncepcion-en-espana-2024/
- Uso de preservativo y número de parejas sexuales en hombres que tienen sexo con hombres con sífilis. (n.d.). Retrieved October 15, 2025, from https://www.actasdermo.org/es-pdf-S0001731010003364
- Unidad de vigilancia de VIH, ITS y hepatitis. (2024). VIGILANCIA EPIDEMIOLÓGICA DEL VIH y SIDA EN ESPAÑA 2023. In Centro Nacional de Epidemiología, Instituto de Salud Carlos III/ División de control de VIH, ITS, Hepatitis virales y tuberculosis, & Ministerio de Sanidad, SISTEMA DE INFORMACIÓN SOBRE NUEVOS DIAGNÓSTICOS DE VIH REGISTRO NACIONAL DE CASOS DE SIDA [Report]. https://www.sanidad.gob.es/ciudadanos/enfLesiones/enfTransmisibles/sida/vigilancia/docs/Informe_VIH_SIDA_2023_Nov_2024_def.pdf
- National Library of Medicine. (n.d.). VIH. Retrieved October 16, 2025, from https://medlineplus.gov/spanish/hiv.html

